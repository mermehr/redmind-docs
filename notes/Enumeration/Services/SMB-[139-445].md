# Server Message Block

## Common Attack Paths

### Enumeration
- [ ] Service discovery → `nmap -p 139,445 --script=smb*`
- [ ] Null sessions → `smbclient -L //target/ -N`
- [ ] User/group enumeration → `enum4linux -a`
- [ ] Share listing → `smbmap -H target`

### Attack Paths
- Null session → gather usernames/shares → brute force / password spray
- Weak/default creds → direct access to shares
- SMB relay (Responder + ntlmrelayx)
- Exploits → EternalBlue (MS17-010), SMBGhost
- Lateral movement → Pass-the-Hash, Kerberos tickets

### Auxiliary Notes
- Always check for SMB signing (mitigates relays).
- Scanning can trigger AV/IDS in corp environments.
- Loot shares for configs, saved creds, cleartext passwords.
- Post-exfil → dump SAM database (`impacket-secretsdump`).

---

## General Enumeration

*Common Commands*

`sudo nmap 10.129.14.128 -sV -sC -p139,445`

#### SMBClient

*List Shares:*

`smbclient -N -L //10.129.14.128`

*Connect to share:*

`smbclient //10.129.14.128/notes`

### RPCclient

`rpcclient -U "" 10.129.14.128`

*Commands:*

| Query | Description |
| --- |  --- |
| srvinfo | Server information. |
| enumdomains | Enumerate all domains that are deployed in the network. |
| querydominfo | Provides domain, server, and user information of deployed domains. |
| netshareenumall | Enumerates all available shares. |
| netsharegetinfo <share> | Provides information about a specific share. |
| enumdomusers | Enumerates all domain users. |
| queryuser <RID> | Provides information about a specific user. |

### Brute Forcing User RIDs

`
for i in $(seq 500 1100);do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\\n' $i)" | grep "User Name\\|user\_rid\\|group\_rid" && echo "";done
`

### Impacket - Samrdump.py

`
samrdump.py 10.129.14.128
`

### SMBmap

`smbmap -H 10.129.14.128`

### Enum4Linux-ng - Enumeration

`./enum4linux-ng.py 10.129.14.128 -A`